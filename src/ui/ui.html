<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="style.css" />
<script type="text/javascript" src="jquery-1.8.3.min.js"></script>
<script type="text/javascript">

activeTab = null;
nextId = 0;
progressBarBgMargin = 0;

$(document).ready(function() {

    var urlBar = $("#urlBar");
    urlBar.keypress(function(e) {
        return e.which != 13;
    });
    urlBar.keyup(function(e) {
        if (e.which == 13) {
            window.loadUrl();
            return false;
        }
        return true;
    });
    $("#urlBarBgCenter").click(function() {
        urlBar.focus();
    });

    $("#plus").click(addEmptyTab);

    // Function stubs to debug UI on a browser
    if (!window._addTab) {
        var foo = function() {};
        window._addTab = foo;
        window._setCurrentTab = foo;
        window._loadUrl = foo;
        window._back = foo;
        window._forward = foo;
    }

    progressBarBgMargin = parseInt($("#progressBarFill").css("margin-left"));
    addEmptyTab();
});


function progressFinished()
{
    $("#progressBar").animate({opacity: 0.0}, 200);
}

function progressStarted()
{
    progressChanged(0);
    $("#progressBar").animate({opacity: 1.0}, 200);
}

function progressChanged(value)
{
    $("#progressBar").width(($("#urlBarBgFill").width() * value) + progressBarBgMargin);
}

function addEmptyTab()
{
    var div = document.createElement("div");
    var tabId = nextId++;
    div.id = String(tabId);
    div.className = "tab";
    div.appendChild(document.createTextNode("New Tab"));
    div.onclick = function() { selectTab(div); }
    document.getElementById("tabContainer").appendChild(div);
    window._addTab(tabId);
    div._url = "http://";
    $("#urlBar").text(div._url);
    selectTab(div);
}

function selectTab(obj)
{
    if (activeTab == obj)
        return;

    if (activeTab)
        activeTab.className = "tab";

    obj.className = "tab active";
    activeTab = obj;
    window._setCurrentTab(parseInt(activeTab.id));
    var urlBar = document.getElementById("urlBar");
    urlBar.value = activeTab._url;
    if (urlBar.innerText == "http://")
        urlBar.focus();
}

function loadUrl()
{
    var urlBar = document.getElementById("urlBar");
    var url = urlBar.innerText;
    window._loadUrl(url);
    activeTab._url = url;
    urlBar.blur();
}

function goBack()
{
    window._back();
}

function goForward()
{
    window._forward();
}

</script>
</head>
<body>
    <div id="tabBar">
        <div id="tabContainer"></div>
        <div id="plus" class="tab"><img src="images/plus.png" /></div>
    </div>
    <div class="toolBarRow">
        <div id="btnBack" onclick="goBack();"></div>
        <div id="btnForward" onclick="goForward();"></div>
        <div id="btnRefresh" onClick=""></div>

        <!-- Url bar -->
        <div id="urlBarBg">
            <div id="urlBarBgFill">
                <div id="progressBar">
                    <div id="progressBarFill">
                    </div>
                </div>
                <div id="urlBar" contentEditable></div>
            </div>
        </div>
    </div>

</body>
</html>
